<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Schlaf-Tracker</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body { font-family: Arial, sans-serif; background: #fff; color: #000; margin: 20px; }
  h1 { text-align: center; }
  .section { margin-bottom: 40px; }
  label { display: inline-block; width: 200px; margin-right: 10px; }
  input[type="number"], input[type="time"], select { width: 100px; margin-bottom: 10px; }
  button { padding: 5px 10px; margin-top: 10px; }
  canvas { background: #fff; margin-top: 20px; }
</style>
</head>
<body>

<h1>Schlaf-Tracker</h1>

<div class="section">
  <h2>Datum</h2>
  <input type="date" id="entryDate" value="">
</div>

<div class="section">
  <h2>Schlafzeiten</h2>
  <label>Einschlafzeit:</label><input type="time" id="sleepTime"><br>
  <label>Aufstehzeit:</label><input type="time" id="wakeTime"><br>
</div>

<div class="section">
  <h2>Aufwachmomente (1-10)</h2>
  <input type="number" id="wakeCount" min="1" max="10">
</div>

<div class="section">
  <h2>Energielevel (1-10)</h2>
  <label>Gesamtenergie:</label><input type="number" id="energyTotal" min="1" max="10"><br>
  <label>Energie Schule:</label><input type="number" id="energySchool" min="1" max="10"><br>
  <label>Energie Zuhause:</label><input type="number" id="energyHome" min="1" max="10"><br>
</div>

<div class="section">
  <h2>Lifestyle-Faktoren</h2>
  <label>Koffein konsumiert (Ja/Nein):</label>
  <select id="caffeine">
    <option value="yes">Ja</option>
    <option value="no">Nein</option>
  </select><br>
  <label>Alkohol konsumiert (Ja/Nein):</label>
  <select id="alcohol">
    <option value="yes">Ja</option>
    <option value="no">Nein</option>
  </select><br>
  <label>Sport gemacht (Ja/Nein):</label>
  <select id="sport">
    <option value="yes">Ja</option>
    <option value="no">Nein</option>
  </select><br>
  <label>Handy < 60min vor Schlaf (Ja/Nein):</label>
  <select id="phone">
    <option value="yes">Ja</option>
    <option value="no">Nein</option>
  </select><br>
  <label>Letzte Mahlzeit vor Schlaf (Minuten):</label>
  <input type="number" id="mealMinutes" min="0"><br>
  <label>Stress (Ja/Nein):</label>
  <select id="stress">
    <option value="yes">Ja</option>
    <option value="no">Nein</option>
  </select><br>
</div>

<div class="section">
  <h2>Kalorien & Gewicht</h2>
  <label>Kalorien:</label><input type="number" id="calories" min="0" max="5000"><br>
  <label>Gewicht (kg):</label><input type="number" id="weight" min="0" max="200"><br>
</div>

<button onclick="saveData()">Speichern</button>

<div class="section">
  <h2>Diagramme</h2>
  <canvas id="sleepChart"></canvas>
  <canvas id="energyChart"></canvas>
  <canvas id="lifestyleChart"></canvas>
  <canvas id="sleepTimeChart"></canvas>
  <canvas id="caloriesChart"></canvas>
</div>

<script>
let storedData = JSON.parse(localStorage.getItem('sleepTracker')) || {};

document.getElementById('entryDate').value = new Date().toISOString().split('T')[0];

function saveData() {
    const date = document.getElementById('entryDate').value;
    storedData[date] = {
        sleepTime: document.getElementById('sleepTime').value,
        wakeTime: document.getElementById('wakeTime').value,
        wakeCount: Number(document.getElementById('wakeCount').value),
        energyTotal: Number(document.getElementById('energyTotal').value),
        energySchool: Number(document.getElementById('energySchool').value),
        energyHome: Number(document.getElementById('energyHome').value),
        caffeine: document.getElementById('caffeine').value,
        alcohol: document.getElementById('alcohol').value,
        sport: document.getElementById('sport').value,
        phone: document.getElementById('phone').value,
        mealMinutes: Number(document.getElementById('mealMinutes').value),
        stress: document.getElementById('stress').value,
        calories: Number(document.getElementById('calories').value),
        weight: Number(document.getElementById('weight').value)
    };
    localStorage.setItem('sleepTracker', JSON.stringify(storedData));
    updateCharts();
}

function calculateSleepDuration(sleep, wake) {
    if(!sleep || !wake) return 0;
    let [sh, sm] = sleep.split(':').map(Number);
    let [wh, wm] = wake.split(':').map(Number);
    let duration = (wh*60 + wm) - (sh*60 + sm);
    if(duration < 0) duration += 24*60;
    return duration / 60; // Stunden
}

function updateCharts() {
    const dates = Object.keys(storedData).sort();
    
    // Schlafdauer & Aufwachmomente
    let sleepDurations = dates.map(d => calculateSleepDuration(storedData[d].sleepTime, storedData[d].wakeTime));
    let wakeCounts = dates.map(d => storedData[d].wakeCount);
    
    new Chart(document.getElementById('sleepChart'), {
        type: 'line',
        data: {
            labels: dates,
            datasets: [
                { label: 'Schlafdauer (h)', data: sleepDurations, borderColor: 'green', fill: false },
                { label: 'Aufwachmomente', data: wakeCounts, borderColor: 'red', fill: false }
            ]
        }
    });
    
    // Energielevel
    let energyTotal = dates.map(d => storedData[d].energyTotal);
    let energySchool = dates.map(d => storedData[d].energySchool);
    let energyHome = dates.map(d => storedData[d].energyHome);
    new Chart(document.getElementById('energyChart'), {
        type: 'line',
        data: {
            labels: dates,
            datasets: [
                { label: 'Gesamtenergie', data: energyTotal, borderColor: 'green', fill: false },
                { label: 'Energie Schule', data: energySchool, borderColor: 'blue', fill: false },
                { label: 'Energie Zuhause', data: energyHome, borderColor: 'purple', fill: false }
            ]
        }
    });
    
    // Lifestyle-Faktoren
    let red = 0, green = 0;
    dates.forEach(d => {
        ['caffeine','alcohol','sport','phone','stress'].forEach(f => {
            if(storedData[d][f] === 'yes') green++;
            else red++;
        });
        if(storedData[d].mealMinutes >= 180) green++;
        else red++;
    });
    new Chart(document.getElementById('lifestyleChart'), {
        type: 'pie',
        data: {
            labels: ['Gut','Schlecht'],
            datasets: [{ data: [green, red], backgroundColor: ['green','red'] }]
        }
    });
    
    // Kalorien & Gewicht
    let calories = dates.map(d => storedData[d].calories);
    let weight = dates.map(d => storedData[d].weight);
    new Chart(document.getElementById('caloriesChart'), {
        type: 'line',
        data: {
            labels: dates,
            datasets: [
                { label: 'Kalorien', data: calories, borderColor: 'red', fill: false },
                { label: 'Gewicht', data: weight, borderColor: 'gray', fill: false }
            ]
        }
    });
}

updateCharts();
</script>

</body>
</html>